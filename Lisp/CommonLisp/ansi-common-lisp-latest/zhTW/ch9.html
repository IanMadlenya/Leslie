<!DOCTYPE HTML>

  <html xmlns="http://www.w3.org/1999/xhtml" lang="zh">

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
<title>第九章：數字 &mdash; ANSI Common Lisp 中文版</title>
    
<!-- RTD <head> -->
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript" src="//media.readthedocs.org/javascript/underscore.js"></script>
<script type="text/javascript" src="//media.readthedocs.org/javascript/doctools.js"></script>

<script type="text/javascript">
  // This is included here for Javascript that doesn't have access to the templates.
  var doc_version = "latest";
  var doc_slug = "ansi-common-lisp";
</script>

<script type="text/javascript" src="//media.readthedocs.org/javascript/rtd.js"></script>
<!-- end RTD <head> -->

    <link rel="stylesheet" href="../_static/han.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/rosefinch.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/main.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:       '../',
        VERSION:        '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX:    '.html',
        HAS_SOURCE:     true
      };
    </script>
    <script type="text/javascript" src="../_static/han.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/javascript" src=../_static/jquery.dimensions.js"></script>
  <script type="text/javascript" src="../_static/main.js"></script><link rel="top" title="ANSI Common Lisp 中文版" href="../index.html" /></head>

  <body><div class="navbar navbar-static-top navbar-inverse">
        <div id="top-bar" class="navbar-inner">

          <h1 id="logo">ANSI Common Lisp 中文版<a href="../index.html" class="brand">ANSI Common Lisp 中文版</a></h1>
          <ul class="nav"></ul><a href="https://github.com/acl-translation/acl-chinese"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
        </div>
      </div><div class="content container-fluid">
        <div class="row-fluid"><div class="document span9"><article >
                <div class="documentwrapper"><div class="body"><div class="section" id="id1">
<h1>第九章：數字<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>處理數字是 Common Lisp 的強項之一。Common Lisp 有著豐富的數值型別 (numeric types)，而 Common Lisp 操作數字的特性與任何語言比起來更受人喜愛。</p>
<div class="section" id="types">
<h2>9.1 型別 (Types)<a class="headerlink" href="#types" title="永久链接至标题">¶</a></h2>
<p>Common Lisp 提供了四種不同種類的數字：整數 (integers)、浮點數 (floating-point numbers)、比值 (ratios) 與複數 (complex number)。本章所描述的函數適用於所有種類的數字。有幾個不能用在複數的會特別註明。</p>
<p>一個整數是寫成一串數字： <tt class="docutils literal"><span class="pre">2001</span></tt> 。一個浮點數是可以寫成一串包含小數點的數字， <tt class="docutils literal"><span class="pre">253.72</span></tt> ，或是用科學表示法， <tt class="docutils literal"><span class="pre">2.5372e2</span></tt> 。一個比值是寫成一個由整數組成的分數： <tt class="docutils literal"><span class="pre">2/3</span></tt> 。而複數 <tt class="docutils literal"><span class="pre">a+bi</span></tt> 是寫成 <tt class="docutils literal"><span class="pre">#c(a</span> <span class="pre">b)</span></tt> ，其中 <tt class="docutils literal"><span class="pre">a</span></tt> 與 <tt class="docutils literal"><span class="pre">b</span></tt> 是任兩個同樣種類的實數 (real number)。</p>
<p>判斷式 <tt class="docutils literal"><span class="pre">integerp</span></tt> , <tt class="docutils literal"><span class="pre">floatp</span></tt> 以及 <tt class="docutils literal"><span class="pre">complexp</span></tt> 對於相對應的數字種類回傳真。圖 9.1 展示了數值型別的層級 (hierarchy of numeric types)。</p>
<div class="figure">
<img alt="../_images/Figure-9.11.png" src="../_images/Figure-9.11.png" />
</div>
<p><strong>圖 9.1: 數值型別</strong></p>
<p>以下是某些通用的經驗法則，來決定一個計算過程會回傳何種數字：</p>
<ol class="arabic simple">
<li>如果一個數值函數 (numeric function)接受一個或多個浮點數作為參數，則回傳值會是一個浮點數 (或是一個由浮點數組成的複數)。所以 <tt class="docutils literal"><span class="pre">(+</span> <span class="pre">1.0</span> <span class="pre">2)</span></tt> 求值成 <tt class="docutils literal"><span class="pre">3.0</span></tt> ，而 <tt class="docutils literal"><span class="pre">(+</span> <span class="pre">#c(0</span> <span class="pre">1.0)</span> <span class="pre">2)</span></tt> 求值成 <tt class="docutils literal"><span class="pre">#c(2.0</span> <span class="pre">1.0)</span></tt> 。</li>
<li>可約分的比值會被轉換成整數。所以 <tt class="docutils literal"><span class="pre">(/</span> <span class="pre">10</span> <span class="pre">2)</span></tt> 會回傳 <tt class="docutils literal"><span class="pre">5</span></tt> 。</li>
<li>若計算過程中複數的虛部會變成 <tt class="docutils literal"><span class="pre">0</span></tt> ，則複數會被轉成實數 。所以 <tt class="docutils literal"><span class="pre">(+</span> <span class="pre">#c(1</span> <span class="pre">-1)</span> <span class="pre">#c(2</span> <span class="pre">1))</span></tt> 求值成 <tt class="docutils literal"><span class="pre">3</span></tt> 。</li>
</ol>
<p>第二、第三個規則可以在參數被讀取時直接應用，所以：</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">ratiop</span> <span class="m">2/2</span><span class="p">)</span> <span class="p">(</span><span class="nb">complexp</span> <span class="m">#c</span><span class="p">(</span><span class="mi">1</span> <span class="mi">0</span><span class="p">)))</span>
<span class="p">(</span><span class="no">NIL</span> <span class="no">NIL</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="conversion-and-extraction">
<h2>9.2 轉換及取出 (Conversion and Extraction)<a class="headerlink" href="#conversion-and-extraction" title="永久链接至标题">¶</a></h2>
<p>Lisp 提供函數來做四種不同類型的數字的轉換 (converting)及取出位數 (extracting component)。函數 <tt class="docutils literal"><span class="pre">float</span></tt> 將任何實數轉換成一個浮點數:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="nb">float</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="m">2/3</span> <span class="mf">.5</span><span class="p">))</span>
<span class="p">(</span><span class="mf">1.0</span> <span class="mf">0.6666667</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>將數字轉成整數未必需要轉換，因為它可能牽涉到某些資訊的喪失。函數 <tt class="docutils literal"><span class="pre">truncate</span></tt> 回傳任何實數的整數部分:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">truncate</span> <span class="mf">1.3</span><span class="p">)</span>
<span class="mi">1</span>
<span class="mf">0.29999995</span>
</pre></div>
</td></tr></table></div>
<p>第二個回傳值是傳入的參數減去第一個回傳值。(會有 0.00000005 的差是因為浮點數的計算本來就不精確。)</p>
<p>函數 <tt class="docutils literal"><span class="pre">floor</span></tt> 與 <tt class="docutils literal"><span class="pre">ceiling</span></tt> 以及 <tt class="docutils literal"><span class="pre">round</span></tt> 也從它們的參數中導出整數。使用 <tt class="docutils literal"><span class="pre">floor</span></tt> 回傳小於等於其參數的最大整數，而 <tt class="docutils literal"><span class="pre">ceiling</span></tt> 回傳大於或等於其參數的最小整數，我們可以將 <tt class="docutils literal"><span class="pre">mirror?</span></tt> (46 頁，譯註: 3.11 節)改成可以找出所有迴文 (palindromes)的版本:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">defun</span> <span class="nv">palindrome?</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">mid</span> <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">equal</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">x</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">floor</span> <span class="nv">mid</span><span class="p">))</span>
           <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">ceiling</span> <span class="nv">mid</span><span class="p">))))))</span>
</pre></div>
</td></tr></table></div>
<p>和 <tt class="docutils literal"><span class="pre">truncate</span></tt> 一樣， <tt class="docutils literal"><span class="pre">floor</span></tt> 與 <tt class="docutils literal"><span class="pre">ceiling</span></tt> 也返回傳入參數與第一個回傳值的差作為第二個值。</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">floor</span> <span class="mf">1.5</span><span class="p">)</span>
<span class="mi">1</span>
<span class="mf">0.5</span>
</pre></div>
</td></tr></table></div>
<p>實際上，我們可以把 <tt class="docutils literal"><span class="pre">truncate</span></tt> 想成是這樣定義的:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">defun</span> <span class="nv">our-truncate</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">floor</span> <span class="nv">n</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">ceiling</span> <span class="nv">n</span><span class="p">)))</span>
</pre></div>
</td></tr></table></div>
<p>函數 <tt class="docutils literal"><span class="pre">round</span></tt> 回傳最接近其參數的整數。當參數與兩個整數的距離相等時， Common Lisp 和很多程式語言一樣，不會往上取 (round up)整數。而是取最近的偶數:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="nb">round</span> <span class="o">&#39;</span><span class="p">(</span><span class="mf">-2.5</span> <span class="mf">-1.5</span> <span class="mf">1.5</span> <span class="mf">2.5</span><span class="p">))</span>
<span class="p">(</span><span class="mi">-2</span> <span class="mi">-2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>在某些數值應用中這是好事，因為捨入誤差 (rounding error)傾向於互相抵消。然而如果用戶期望你的程式將某些值取整數時，你必須自己提供這個功能。 <a class="footnote-reference" href="#id4" id="id2">[1]</a> 與其他的函數一樣， <tt class="docutils literal"><span class="pre">round</span></tt> 返回傳入參數與第一個回傳值的差作為第二個值。</p>
<p>函數 <tt class="docutils literal"><span class="pre">mod</span></tt> 僅回傳 <tt class="docutils literal"><span class="pre">floor</span></tt> 會回傳的第二個值；而 <tt class="docutils literal"><span class="pre">rem</span></tt> 回傳 <tt class="docutils literal"><span class="pre">truncate</span></tt> 會回傳的第二個值。我們在 94 頁 (譯註: 5.7 節)使用了 <tt class="docutils literal"><span class="pre">mod</span></tt> 來決定一個數是否可被另一個整除，以及 127 頁(譯註: 7.4 節)用來找出環狀緩衝區 (ring buffer)中，元素實際的位置。</p>
<p>關於實數，函數 <tt class="docutils literal"><span class="pre">signum</span></tt> 回傳 <tt class="docutils literal"><span class="pre">1</span></tt> , <tt class="docutils literal"><span class="pre">0</span></tt> 或 <tt class="docutils literal"><span class="pre">-1</span></tt> ，取決於它的參數是正、零或負數。函數 <tt class="docutils literal"><span class="pre">abs</span></tt> 回傳其參數的絕對值。因此 <tt class="docutils literal"><span class="pre">(*</span> <span class="pre">(abs</span> <span class="pre">x)</span> <span class="pre">(signum</span> <span class="pre">x))</span></tt> 等於 <tt class="docutils literal"><span class="pre">x</span></tt> 。</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="nb">signum</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">-2</span> <span class="mf">-0.0</span> <span class="mf">0.0</span> <span class="mi">0</span> <span class="mf">.5</span> <span class="mi">3</span><span class="p">))</span>
<span class="p">(</span><span class="mi">-1</span> <span class="mf">-0.0</span> <span class="mf">0.0</span> <span class="mi">0</span> <span class="mf">1.0</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>在某些應用裡， <tt class="docutils literal"><span class="pre">-0.0</span></tt> 可能自成一格 (in its own right)，如上所示。其實功能上它幾乎沒有差異，因為數值 <tt class="docutils literal"><span class="pre">-0.0</span></tt> 與 <tt class="docutils literal"><span class="pre">0.0</span></tt> 有一樣的行為。</p>
<p>比值與複數概念上是兩部分結構。(譯註: 像 <strong>Cons</strong> 這樣的兩部分結構) 函數 <tt class="docutils literal"><span class="pre">numerator</span></tt> 與 <tt class="docutils literal"><span class="pre">denominator</span></tt> 回傳一個比值或整數所對應的部份。 (如果數字是整數，前者回傳該數字，而後者回傳 <tt class="docutils literal"><span class="pre">1</span></tt> 。)函數 <tt class="docutils literal"><span class="pre">realpart</span></tt> 與 <tt class="docutils literal"><span class="pre">imgpart</span></tt> 回傳任何數字的實數與虛數部分。 (如果數字不是複數，前者回傳該數字，後者回傳 <tt class="docutils literal"><span class="pre">0</span></tt> 。)</p>
<p>函數 <tt class="docutils literal"><span class="pre">random</span></tt> 接受一個整數或浮點數。一個這樣形式的表達式 <tt class="docutils literal"><span class="pre">(random</span> <span class="pre">n)</span></tt> 回傳一個大於或小於等於 <tt class="docutils literal"><span class="pre">n</span></tt> 的數字，並有著與 <tt class="docutils literal"><span class="pre">n</span></tt> 相同的型別。</p>
</div>
<div class="section" id="comparison">
<h2>9.3 比較 (Comparison)<a class="headerlink" href="#comparison" title="永久链接至标题">¶</a></h2>
<p>判斷式 <tt class="docutils literal"><span class="pre">=</span></tt> 當其參數數值上相等時 –– 即兩者的差為零時，回傳真。</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">1</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="no">T</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">eql</span> <span class="mi">1</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="no">NIL</span>
</pre></div>
</td></tr></table></div>
<p><tt class="docutils literal"><span class="pre">=</span></tt> 比起 <tt class="docutils literal"><span class="pre">eql</span></tt> 來得寬鬆，但它的參數需要是同樣型別。</p>
<p>用來比較數字的判斷式為 <tt class="docutils literal"><span class="pre">&lt;</span></tt> (小於), <tt class="docutils literal"><span class="pre">&lt;=</span></tt> (小於等於), <tt class="docutils literal"><span class="pre">=</span></tt> (等於), <tt class="docutils literal"><span class="pre">&gt;=</span></tt> (大於等於), <tt class="docutils literal"><span class="pre">&gt;</span></tt> (大於) 以及 <tt class="docutils literal"><span class="pre">/=</span></tt> (不同)。以上所有皆接受一個或多個參數。只有一個參數時，它們全回傳真。</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">&lt;=</span> <span class="nv">w</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>等同於一個二元運算元的結合 (conjunction)，應用至每一對參數上:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">&lt;=</span> <span class="nv">w</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;=</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;=</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>由於 <tt class="docutils literal"><span class="pre">/=</span></tt> 若它的兩個參數不等於時回傳真，表達式</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">/=</span> <span class="nv">w</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>等同於</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">/=</span> <span class="nv">w</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">/=</span> <span class="nv">w</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">/=</span> <span class="nv">w</span> <span class="nv">z</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">/=</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">/=</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">/=</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>特殊的判斷式 <tt class="docutils literal"><span class="pre">zerop</span></tt> , <tt class="docutils literal"><span class="pre">plusp</span></tt> 與 <tt class="docutils literal"><span class="pre">minusp</span></tt> 接受一個參數，分別於參數 <tt class="docutils literal"><span class="pre">=</span></tt> , <tt class="docutils literal"><span class="pre">&gt;</span></tt> , <tt class="docutils literal"><span class="pre">&lt;</span></tt> 零時，回傳真。雖然 <tt class="docutils literal"><span class="pre">-0.0</span></tt> (如果實現有使用它) 前面有個負號，但它 <tt class="docutils literal"><span class="pre">=</span></tt> 零，</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">minusp</span> <span class="mf">-0.0</span><span class="p">)</span> <span class="p">(</span><span class="nb">zerop</span> <span class="mf">-0.0</span><span class="p">))</span>
<span class="p">(</span><span class="no">NIL</span> <span class="no">T</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>因此使用 <tt class="docutils literal"><span class="pre">zerop</span></tt> 而不是 <tt class="docutils literal"><span class="pre">minusp</span></tt> 。</p>
<p>判斷式 <tt class="docutils literal"><span class="pre">oddp</span></tt> 與 <tt class="docutils literal"><span class="pre">evenp</span></tt> 只能用在整數。前者只對奇數回傳真，後者只對偶數回傳真。</p>
<p>本節定義的判斷式中，只有 <tt class="docutils literal"><span class="pre">=</span></tt> , <tt class="docutils literal"><span class="pre">/=</span></tt> 與 <tt class="docutils literal"><span class="pre">zerop</span></tt> 可以用在複數。</p>
<p>函數 <tt class="docutils literal"><span class="pre">max</span></tt> 與 <tt class="docutils literal"><span class="pre">min</span></tt> 分別回傳其參數的最大值與最小值。兩者至少需要給一個參數:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">max</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nb">min</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="mi">5</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>如果參數有包含浮點數的話，結果的型別取決於各家實現。</p>
</div>
<div class="section" id="arithematic">
<h2>9.4 算術 (Arithematic)<a class="headerlink" href="#arithematic" title="永久链接至标题">¶</a></h2>
<p>用來做加減的函數是 <tt class="docutils literal"><span class="pre">+</span></tt> 與 <tt class="docutils literal"><span class="pre">-</span></tt> 。兩者皆可接受任何數量的參數，包括沒有參數，在沒有參數的情況下回傳 <tt class="docutils literal"><span class="pre">0</span></tt> 。(譯註: <tt class="docutils literal"><span class="pre">-</span></tt> 在沒有參數的情況下會報錯，至少要一個參數) 一個這樣形式的表達式 <tt class="docutils literal"><span class="pre">(-</span> <span class="pre">n)</span></tt> 回傳 <tt class="docutils literal"><span class="pre">-n</span></tt> 。一個這樣形式的表達式</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">-</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>等同於</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">z</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>有兩個函數 <tt class="docutils literal"><span class="pre">1+</span></tt> 與 <tt class="docutils literal"><span class="pre">1-</span></tt> ，分別將參數加上 <tt class="docutils literal"><span class="pre">1</span></tt> 與減去 <tt class="docutils literal"><span class="pre">1</span></tt> 並回傳。 <tt class="docutils literal"><span class="pre">1-</span></tt> 有一點誤導，因為 <tt class="docutils literal"><span class="pre">(1-</span> <span class="pre">x)</span></tt> 回傳 <tt class="docutils literal"><span class="pre">x-1</span></tt> 而不是 <tt class="docutils literal"><span class="pre">1-x</span></tt> 。</p>
<p>巨集 <tt class="docutils literal"><span class="pre">incf</span></tt> 及    <tt class="docutils literal"><span class="pre">decf</span></tt> 分別增加與減少參數。一個這樣形式的表達式 <tt class="docutils literal"><span class="pre">(incf</span> <span class="pre">x</span> <span class="pre">n)</span></tt> 類似於 <tt class="docutils literal"><span class="pre">(setf</span> <span class="pre">x</span> <span class="pre">(+</span> <span class="pre">x</span> <span class="pre">n))</span></tt> 的效果，而 <tt class="docutils literal"><span class="pre">(decf</span> <span class="pre">x</span> <span class="pre">n)</span></tt> 類似於 <tt class="docutils literal"><span class="pre">(setf</span> <span class="pre">x</span> <span class="pre">(-</span> <span class="pre">x</span> <span class="pre">n))</span></tt> 的效果。這兩個情況裡，第二個參數是選擇性的並預設為 <tt class="docutils literal"><span class="pre">1</span></tt> 。</p>
<p>用來做乘法的函數是 <tt class="docutils literal"><span class="pre">*</span></tt> 。接受任何數量的參數。沒有給參數時回傳 <tt class="docutils literal"><span class="pre">1</span></tt> 。否則回傳參數的乘積。</p>
<p>除法函數 <tt class="docutils literal"><span class="pre">/</span></tt> 至少預期一個參數。一個這樣形式的呼叫 <tt class="docutils literal"><span class="pre">(/</span> <span class="pre">n)</span></tt> 等同於 <tt class="docutils literal"><span class="pre">(/</span> <span class="pre">1</span> <span class="pre">n)</span></tt> ，</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">/</span> <span class="mi">3</span><span class="p">)</span>
<span class="m">1/3</span>
</pre></div>
</td></tr></table></div>
<p>而一個這樣形式的呼叫</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">/</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>等同於</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">z</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>注意 <tt class="docutils literal"><span class="pre">-</span></tt> 與 <tt class="docutils literal"><span class="pre">/</span></tt> 兩者在這方面的相似性。</p>
<p>當給定兩個整數時， <tt class="docutils literal"><span class="pre">/</span></tt> 若第一個不是第二個的倍數時，會回傳一個比值:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">/</span> <span class="mi">365</span> <span class="mi">12</span><span class="p">)</span>
<span class="m">365/12</span>
</pre></div>
</td></tr></table></div>
<p>舉例來說，如果你試著找出平均每一個月有多長，你可能會有頂層在逗你玩的想法。在這個情況下，你需要的是對比值呼叫 <tt class="docutils literal"><span class="pre">float</span></tt> ，而不是對兩個整數做 <tt class="docutils literal"><span class="pre">/</span></tt> 。</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">float</span> <span class="m">365/12</span><span class="p">)</span>
<span class="mf">30.416666</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="exponentiation">
<h2>9.5 指數 (Exponentiation)<a class="headerlink" href="#exponentiation" title="永久链接至标题">¶</a></h2>
<p>要找到 <span class="math">\(x^n\)</span> 我們呼叫 <tt class="docutils literal"><span class="pre">(expt</span> <span class="pre">x</span> <span class="pre">n)</span></tt> ，</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">5</span><span class="p">)</span>
<span class="mi">32</span>
</pre></div>
</td></tr></table></div>
<p>而要找到 <span class="math">\(log_nx\)</span> 我們呼叫 <tt class="docutils literal"><span class="pre">(log</span> <span class="pre">x</span> <span class="pre">n)</span></tt> :</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">log</span> <span class="mi">32</span> <span class="mi">2</span><span class="p">)</span>
<span class="mf">5.0</span>
</pre></div>
</td></tr></table></div>
<p>通常回傳一個浮點數。</p>
<p>要找到 <span class="math">\(e^x\)</span> 有一個特別的函數 <tt class="docutils literal"><span class="pre">exp</span></tt> ，</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">exp</span> <span class="mi">2</span><span class="p">)</span>
<span class="mf">7.389056</span>
</pre></div>
</td></tr></table></div>
<p>而要找到一個自然對數，你可以使用 <tt class="docutils literal"><span class="pre">log</span></tt> 就好，因為第二個參數預設為 <tt class="docutils literal"><span class="pre">e</span></tt> :</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">log</span> <span class="mf">7.389056</span><span class="p">)</span>
<span class="mf">2.0</span>
</pre></div>
</td></tr></table></div>
<p>要找到立方根，你可以呼叫 <tt class="docutils literal"><span class="pre">expt</span></tt> 用一個比值作為第二個參數，</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">27</span> <span class="m">1/3</span><span class="p">)</span>
<span class="mf">3.0</span>
</pre></div>
</td></tr></table></div>
<p>但要找到平方根，函數 <tt class="docutils literal"><span class="pre">sqrt</span></tt> 會比較快:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">sqrt</span> <span class="mi">4</span><span class="p">)</span>
<span class="mf">2.0</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="trigometric-functions">
<h2>9.6 三角函數 (Trigometric Functions)<a class="headerlink" href="#trigometric-functions" title="永久链接至标题">¶</a></h2>
<p>常數 <tt class="docutils literal"><span class="pre">pi</span></tt> 是 <tt class="docutils literal"><span class="pre">π</span></tt> 的浮點表示法。它的精度 (precision)取決於各家實現。函數 <tt class="docutils literal"><span class="pre">sin</span></tt> , <tt class="docutils literal"><span class="pre">cos</span></tt> 及 <tt class="docutils literal"><span class="pre">tan</span></tt> 分別可以找到正弦、餘弦及正交函數，其中角度以徑度 (radian)表示:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">pi</span> <span class="mi">4</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">sin</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">cos</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">tan</span> <span class="nv">x</span><span class="p">)))</span>
<span class="p">(</span><span class="mf">0.7071067811865475d0</span> <span class="mf">0.7071067811865476d0</span> <span class="mf">1.0d0</span><span class="p">)</span>
<span class="c1">;;; 譯註: CCL 1.8  SBCL 1.0.55 下的結果是</span>
<span class="c1">;;; (0.7071067811865475D0 0.7071067811865476D0 0.9999999999999999D0)</span>
</pre></div>
</td></tr></table></div>
<p>這些函數全部接受負數及複數參數。</p>
<p>函數 <tt class="docutils literal"><span class="pre">asin</span></tt> , <tt class="docutils literal"><span class="pre">acos</span></tt> 及 <tt class="docutils literal"><span class="pre">atan</span></tt> 實現了正弦、餘弦及正交的反函數 (inverse)。參數介於 <tt class="docutils literal"><span class="pre">-1</span></tt> 與 <tt class="docutils literal"><span class="pre">1</span></tt> 之間（包含）時， <tt class="docutils literal"><span class="pre">asin</span></tt> 與 <tt class="docutils literal"><span class="pre">acos</span></tt> 回傳實數。</p>
<p>雙曲 (hyperbolic)正弦、餘弦及正交分別由 <tt class="docutils literal"><span class="pre">sinh</span></tt> , <tt class="docutils literal"><span class="pre">cosh</span></tt> 及 <tt class="docutils literal"><span class="pre">tanh</span></tt> 實現。它們的反函數同樣為 <tt class="docutils literal"><span class="pre">asinh</span></tt> , <tt class="docutils literal"><span class="pre">acosh</span></tt> 以及 <tt class="docutils literal"><span class="pre">atanh</span></tt> 。</p>
</div>
<div class="section" id="representations">
<h2>9.7 表示法 (Representations)<a class="headerlink" href="#representations" title="永久链接至标题">¶</a></h2>
<p>Common Lisp 對於整數的大小沒有限制。可以塞進一個字 (word)記憶體的小整數稱為定數 (fixnums)。當一個計算過程整數無法塞入一個字 (word)時，Lisp 切換至使用多個記憶體字的表示法（一個大數 「bignum」)。所以一個整數的大小限制取決於實體記憶體，而不是語言。</p>
<p>常數 <tt class="docutils literal"><span class="pre">most-positive-fixnum</span></tt> 與 <tt class="docutils literal"><span class="pre">most-negative-fixnum</span></tt> 表示了一個實現不使用大數 (bignum)可表示的最大數字幅度 (magnitude)。在很多實現裡，它們為：</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">values</span> <span class="nv">most-positive-fixnum</span> <span class="nv">most-negative-fixnum</span><span class="p">)</span>
<span class="mi">536870911</span>
<span class="mi">-536870912</span>
<span class="c1">;;; 譯註: CCL 1.8 的結果為</span>
<span class="mi">1152921504606846975</span>
<span class="mi">-1152921504606846976</span>
<span class="c1">;;; SBCL 1.0.55 的結果為</span>
<span class="mi">4611686018427387903</span>
<span class="mi">-4611686018427387904</span>
</pre></div>
</td></tr></table></div>
<p>判斷式 <tt class="docutils literal"><span class="pre">typep</span></tt> 接受一個參數及一個型別名稱，並回傳指定型別的參數。所以，</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">typep</span> <span class="mi">1</span> <span class="ss">&#39;fixnum</span><span class="p">)</span>
<span class="no">T</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">most-positive-fixnum</span><span class="p">)</span> <span class="ss">&#39;bignum</span><span class="p">)</span>
<span class="no">T</span>
</pre></div>
</td></tr></table></div>
<p>浮點數字的數值限制是取決於各家實現的。 Common Lisp 提供了最多四種型別的浮點數：短浮點 <tt class="docutils literal"><span class="pre">short-float</span></tt> 、 單浮點 <tt class="docutils literal"><span class="pre">single-float</span></tt> 、雙浮點 <tt class="docutils literal"><span class="pre">double-float</span></tt> 以及長浮點 <tt class="docutils literal"><span class="pre">long-float</span></tt> 。Common Lisp 的實現不需要用不同的格式來表示這四種型別（很少實現這麼做）。</p>
<p>一般來說，短浮點應可塞入一個字 (word)，單浮點與雙浮點提供普遍的單與雙精度浮點數的概念，而長浮點，如果想要的話可以是很大的數。但一個實現可以使這四個型別沒有區別，也是完全沒有問題的。</p>
<p>你可以指定你想要何種格式的浮點數，當一個數字是用科學表示法時，可以通過將 <tt class="docutils literal"><span class="pre">e</span></tt> 替換為 <tt class="docutils literal"><span class="pre">s</span></tt> <tt class="docutils literal"><span class="pre">f</span></tt> <tt class="docutils literal"><span class="pre">d</span></tt> <tt class="docutils literal"><span class="pre">l</span></tt> 來得到不同的浮點數。(你也可以使用大寫，這對長浮點來說是個好主意，因為 <tt class="docutils literal"><span class="pre">l</span></tt> 看起來太像 <tt class="docutils literal"><span class="pre">1</span></tt> 了。)所以要表示最大的 <tt class="docutils literal"><span class="pre">1.0</span></tt> 你可以寫 <tt class="docutils literal"><span class="pre">1L0</span></tt> 。</p>
<p>(譯註: <tt class="docutils literal"><span class="pre">s</span></tt> 為短浮點、 <tt class="docutils literal"><span class="pre">f</span></tt> 為單浮點、 <tt class="docutils literal"><span class="pre">d</span></tt> 為雙浮點、 <tt class="docutils literal"><span class="pre">l</span></tt> 為長浮點。)</p>
<p>在給定的實現裡，用十六個全域常數標明了每個格式的限制。它們的名字是這種形式: <tt class="docutils literal"><span class="pre">m-s-f</span></tt> ，其中 <tt class="docutils literal"><span class="pre">m</span></tt> 是 <tt class="docutils literal"><span class="pre">most</span></tt> 或 <tt class="docutils literal"><span class="pre">least</span></tt> ， <tt class="docutils literal"><span class="pre">s</span></tt> 是 <tt class="docutils literal"><span class="pre">positive</span></tt> 或 <tt class="docutils literal"><span class="pre">negative</span></tt> ，而 <tt class="docutils literal"><span class="pre">f</span></tt> 是四種浮點數之一。</p>
<p>浮點數乾涸與溢出被 Common Lisp 視為錯誤 :</p>
<p>(譯註: 這裡調皮了一下，使用了乾涸。我們說一個 stack 滿了要 push 時叫做溢出 (overflow)，stack 為空又要 pop 時叫做下溢「underflow」，但是下溢聽起來以為是褲子濕了…)</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">most-positive-long-float</span> <span class="mi">10</span><span class="p">)</span>
<span class="nv">Error:</span> <span class="kt">floating-point-overflow</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="example-ray-tracing">
<h2>9.8 範例：追蹤光線 (Example: Ray-Tracing)<a class="headerlink" href="#example-ray-tracing" title="永久链接至标题">¶</a></h2>
<p>作為一個數值應用的範例，本節示範了如何撰寫一個光線追蹤器 (ray-tracer)。光線追蹤是一個高級的 (deluxe)渲染算法: 它產生出逼真的圖像，但需要花點時間。</p>
<p>要產生一個 3D 的圖像，我們至少需要定義四件事: 一個觀測點 (eye)、一個或多個光源、一個由一個或多個平面所組成的模擬世界 (simulated world)，以及一個作為通往這個世界的窗戶的平面 (圖像平面「image plane」)。我們產生出的是模擬世界投影在圖像平面區域的圖像。</p>
<p>讓光線追蹤如此不尋常的是，我們如何找到這個投影: 我們一個一個像素地沿著圖像平面走，追蹤回到模擬世界裡的光線。這個方法帶來三個主要的優勢: 它讓我們容易得到現實世界的光學效應 (optical effect)，如透明度 (transparency)、反射光 (reflected light)以及產生陰影 (cast shadows)；它讓我們可以直接用任何我們想要的幾何的物體，來定義出模擬的世界，而不需要用多變形 (polygons)來建構它們；以及它很簡單實現。</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">defun</span> <span class="nv">sq</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">mag</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">sqrt</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">z</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">unit-vector</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">d</span> <span class="p">(</span><span class="nv">mag</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">values</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">x</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">y</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">z</span> <span class="nv">d</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defstruct</span> <span class="p">(</span><span class="nv">point</span> <span class="p">(</span><span class="ss">:conc-name</span> <span class="no">nil</span><span class="p">))</span>
  <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">distance</span> <span class="p">(</span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">mag</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">p2</span><span class="p">))</span>
       <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">p2</span><span class="p">))</span>
       <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">p2</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">minroot</span> <span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">zerop</span> <span class="nv">a</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">b</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">disc</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">4</span> <span class="nv">a</span> <span class="nv">c</span><span class="p">))))</span>
        <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">minusp</span> <span class="nv">disc</span><span class="p">)</span>
          <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">discrt</span> <span class="p">(</span><span class="nb">sqrt</span> <span class="nv">disc</span><span class="p">)))</span>
            <span class="p">(</span><span class="nb">min</span> <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">discrt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="nv">a</span><span class="p">))</span>
                 <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">discrt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="nv">a</span><span class="p">))))))))</span>
</pre></div>
</td></tr></table></div>
<p><strong>圖 9.2 實用數學函數</strong></p>
<p>圖 9.2 包含了我們在光線追蹤器裡會需要用到的一些實用數學函數。第一個 <tt class="docutils literal"><span class="pre">sq</span></tt> ，回傳其參數的平方。下一個 <tt class="docutils literal"><span class="pre">mag</span></tt> ，回傳一個給定 <tt class="docutils literal"><span class="pre">x</span></tt> <tt class="docutils literal"><span class="pre">y</span></tt> <tt class="docutils literal"><span class="pre">z</span></tt> 所組成向量的大小 (magnitude)。這個函數被接下來兩個函數用到。我們在 <tt class="docutils literal"><span class="pre">unit-vector</span></tt> 用到了，此函數回傳三個數值，來表示與單位向量有著同樣方向的向量，其中向量是由 <tt class="docutils literal"><span class="pre">x</span></tt> <tt class="docutils literal"><span class="pre">y</span></tt> <tt class="docutils literal"><span class="pre">z</span></tt> 所組成的:</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">&gt;</span> <span class="p">(</span><span class="k">multiple-value-call</span> <span class="nf">#&#39;</span><span class="nv">mag</span> <span class="p">(</span><span class="nv">unit-vector</span> <span class="mi">23</span> <span class="mi">12</span> <span class="mi">47</span><span class="p">))</span>
<span class="mf">1.0</span>
</pre></div>
</td></tr></table></div>
<p>我們在 <tt class="docutils literal"><span class="pre">distance</span></tt> 也用到了 <tt class="docutils literal"><span class="pre">mag</span></tt> ，它回傳三維空間中，兩點的距離。（定義 <tt class="docutils literal"><span class="pre">point</span></tt> 結構來有一個 <tt class="docutils literal"><span class="pre">nil</span></tt> 的 <tt class="docutils literal"><span class="pre">conc-name</span></tt> 意味著欄位存取的函數會有跟欄位一樣的名字: 舉例來說， <tt class="docutils literal"><span class="pre">x</span></tt> 而不是 <tt class="docutils literal"><span class="pre">point-x</span></tt> 。)</p>
<p>最後 <tt class="docutils literal"><span class="pre">minroot</span></tt> 接受三個實數， <tt class="docutils literal"><span class="pre">a</span></tt> , <tt class="docutils literal"><span class="pre">b</span></tt> 與 <tt class="docutils literal"><span class="pre">c</span></tt> ，並回傳滿足等式 <span class="math">\(ax^2+bx+c=0\)</span> 的最小實數 <tt class="docutils literal"><span class="pre">x</span></tt> 。當 <tt class="docutils literal"><span class="pre">a</span></tt> 不為 0 時，這個等式的根由下面這個熟悉的式子給出:</p>
<div class="math">
\[x = \dfrac{-b \pm \sqrt{b^2 - 4ac}}{2a}\]</div>
<p>圖 9.3 包含了定義一個最小光線追蹤器的程式碼。 它產生通過單一光源照射的黑白圖像，與觀測點 (eye)處於同個位置。 (結果看起來像是閃光攝影術 (flash photography)拍出來的)</p>
<p><tt class="docutils literal"><span class="pre">surface</span></tt> 結構會用來表示模擬世界中的物體。更精確的說，它會被 <tt class="docutils literal"><span class="pre">included</span></tt> 至定義具體種類物體的結構裡，像是球體 (spheres)。 <tt class="docutils literal"><span class="pre">surface</span></tt> 結構本身只包含一個欄位: 一個 <tt class="docutils literal"><span class="pre">color</span></tt> 範圍從 0 (黑色) 至 1 (白色)。</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">defstruct</span> <span class="nv">surface</span>  <span class="nv">color</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*world*</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defconstant</span> <span class="nv">eye</span> <span class="p">(</span><span class="nv">make-point</span> <span class="ss">:x</span> <span class="mi">0</span> <span class="ss">:y</span> <span class="mi">0</span> <span class="ss">:z</span> <span class="mi">200</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">tracer</span> <span class="p">(</span><span class="nb">pathname</span> <span class="k">&amp;optional</span> <span class="p">(</span><span class="nv">res</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">with-open-file</span> <span class="p">(</span><span class="nv">p</span> <span class="nb">pathname</span> <span class="ss">:direction</span> <span class="ss">:output</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">format</span> <span class="nv">p</span> <span class="s">&quot;P2 ~A ~A 255&quot;</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">res</span> <span class="mi">100</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">res</span> <span class="mi">100</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">inc</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">res</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">y</span> <span class="mi">-50</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">y</span> <span class="nv">inc</span><span class="p">)))</span>
          <span class="p">((</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">-</span> <span class="mi">50</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">inc</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">x</span> <span class="mi">-50</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">inc</span><span class="p">)))</span>
            <span class="p">((</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">-</span> <span class="mi">50</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">inc</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">color-at</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">p</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">color-at</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">unit-vector</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">x</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">eye</span><span class="p">))</span>
                                    <span class="p">(</span><span class="nb">-</span> <span class="nv">y</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">eye</span><span class="p">))</span>
                                    <span class="p">(</span><span class="nb">-</span> <span class="mi">0</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">eye</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">round</span> <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nv">sendray</span> <span class="nv">eye</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span> <span class="mi">255</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">sendray</span> <span class="p">(</span><span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">int</span><span class="p">)</span> <span class="p">(</span><span class="nv">first-hit</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="nv">s</span>
        <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nv">lambert</span> <span class="nv">s</span> <span class="nv">int</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span> <span class="p">(</span><span class="nv">surface-color</span> <span class="nv">s</span><span class="p">))</span>
        <span class="mi">0</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">first-hit</span> <span class="p">(</span><span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">surface</span> <span class="nv">hit</span> <span class="nv">dist</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">s</span> <span class="vg">*world*</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">h</span> <span class="p">(</span><span class="nv">intersect</span> <span class="nv">s</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="nv">h</span>
          <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">d</span> <span class="p">(</span><span class="nv">distance</span> <span class="nv">h</span> <span class="nv">pt</span><span class="p">)))</span>
            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">null</span> <span class="nv">dist</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">d</span> <span class="nv">dist</span><span class="p">))</span>
              <span class="p">(</span><span class="nb">setf</span> <span class="nv">surface</span> <span class="nv">s</span> <span class="nv">hit</span> <span class="nv">h</span> <span class="nv">dist</span> <span class="nv">d</span><span class="p">))))))</span>
    <span class="p">(</span><span class="nb">values</span> <span class="nv">surface</span> <span class="nv">hit</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">lambert</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">int</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">xn</span> <span class="nv">yn</span> <span class="nv">zn</span><span class="p">)</span> <span class="p">(</span><span class="nv">normal</span> <span class="nv">s</span> <span class="nv">int</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">max</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">xr</span> <span class="nv">xn</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">yr</span> <span class="nv">yn</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">zr</span> <span class="nv">zn</span><span class="p">)))))</span>
</pre></div>
</td></tr></table></div>
<p><strong>圖 9.3 光線追蹤。</strong></p>
<p>圖像平面會是由 x 軸與 y 軸所定義的平面。觀測者 (eye) 會在 z 軸，距離原點 200 個單位。所以要在圖像平面可以被看到，插入至 <tt class="docutils literal"><span class="pre">*worlds*</span></tt> 的表面 (一開始為 <tt class="docutils literal"><span class="pre">nil</span></tt>)會有著負的 z 座標。圖 9.4 說明了一個光線穿過圖像平面上的一點，並擊中一個球體。</p>
<div class="figure">
<img alt="../_images/Figure-9.41.png" src="../_images/Figure-9.41.png" />
</div>
<p><strong>圖 9.4: 追蹤光線。</strong></p>
<p>函數 <tt class="docutils literal"><span class="pre">tracer</span></tt> 接受一個路徑名稱，並寫入一張圖片至對應的檔案。圖片檔案會用一種簡單的 ASCII 稱作 PGM 的格式寫入。默認情況下，圖像會是 100x100 。我們 PGM 檔案的標頭 (headers) 會由標籤 <tt class="docutils literal"><span class="pre">P2</span></tt> 組成，伴隨著指定圖片寬度 (breadth)與高度 (height)的整數，初始為 100，單位為 pixel，以及可能的最大值 (255)。檔案剩餘的部份會由 10000 個介於 0 (黑)與 1 (白)整數組成，代表著 100 條 100 像素的水平線。</p>
<p>圖片的解析度可以通過給入明確的 <tt class="docutils literal"><span class="pre">res</span></tt> 來調整。舉例來說，如果 <tt class="docutils literal"><span class="pre">res</span></tt> 是 <tt class="docutils literal"><span class="pre">2</span></tt> ，則同樣的圖像會被渲染成 200x200 。</p>
<p>圖片是一個在圖像平面 100x100 的正方形。每一個像素代表著穿過圖像平面抵達觀測點的光的數量。要找到每個像素光的數量， <tt class="docutils literal"><span class="pre">tracer</span></tt> 呼叫 <tt class="docutils literal"><span class="pre">color-at</span></tt> 。這個函數找到從觀測點至該點的向量，並呼叫 <tt class="docutils literal"><span class="pre">sendray</span></tt> 來追蹤這個向量回到模擬世界的軌跡； <tt class="docutils literal"><span class="pre">sandray</span></tt> 會回傳一個數值介於 0 與 1 之間的亮度 (intensity)，之後會縮放成一個 0 至 255 的整數來顯示。</p>
<p>要決定一個光線的亮度， <tt class="docutils literal"><span class="pre">sendray</span></tt> 需要找到光是從哪個物體所反射的。要辦到這件事，我們呼叫 <tt class="docutils literal"><span class="pre">first-hit</span></tt> ，此函數研究在 <tt class="docutils literal"><span class="pre">*world*</span></tt> 裡的所有平面，並回傳光線最先抵達的平面（如果有的話）。如果光沒有擊中任何東西， <tt class="docutils literal"><span class="pre">sendray</span></tt> 僅回傳背景顏色，按慣例是 <tt class="docutils literal"><span class="pre">0</span></tt> (黑色)。如果光線有擊中某物的話，我們需要找出在光擊中時，有多少數量的光照在該平面。</p>
<p><a class="reference external" href="http://zh.wikipedia.org/zh-tw/%E6%AF%94%E5%B0%94%EF%BC%8D%E6%9C%97%E4%BC%AF%E5%AE%9A%E5%BE%8B">朗伯定律</a> 告訴我們，由平面上一點所反射的光的強度，正比於該點的單位法向量 (unit normal vector) <em>N</em> (這裡是與平面垂直且長度為一的向量)與該點至光源的單位向量 <em>L</em> 的點積 (dot-product):</p>
<div class="math">
\[i = N·L\]</div>
<p>如果光剛好照到這點， <em>N</em> 與 <em>L</em> 會重合 (coincident)，則點積會是最大值， <tt class="docutils literal"><span class="pre">1</span></tt> 。如果將在這時候將平面朝光轉 90 度，則 <em>N</em> 與 <em>L</em> 會垂直，則兩者點積會是 <tt class="docutils literal"><span class="pre">0</span></tt> 。如果光在平面後面，則點積會是負數。</p>
<p>在我們的程式裡，我們假設光源在觀測點 (eye)，所以 <tt class="docutils literal"><span class="pre">lambert</span></tt> 使用了這個規則來找到平面上某點的亮度 (illumination)，回傳我們追蹤的光的單位向量與法向量的點積。</p>
<p>在 <tt class="docutils literal"><span class="pre">sendray</span></tt> 這個值會乘上平面的顏色 (即便是有好的照明，一個暗的平面還是暗的)來決定該點之後總體亮度。</p>
<p>為了簡單起見，我們在模擬世界裡會只有一種物體，球體。圖 9.5 包含了與球體有關的程式碼。球體結構包含了 <tt class="docutils literal"><span class="pre">surface</span></tt> ，所以一個球體會有一種顏色以及 <tt class="docutils literal"><span class="pre">center</span></tt> 和 <tt class="docutils literal"><span class="pre">radius</span></tt> 。呼叫 <tt class="docutils literal"><span class="pre">defsphere</span></tt> 添加一個新球體至世界裡。</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">defstruct</span> <span class="p">(</span><span class="nv">sphere</span> <span class="p">(</span><span class="ss">:include</span> <span class="nv">surface</span><span class="p">))</span>
  <span class="nv">radius</span> <span class="nv">center</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">defsphere</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">r</span> <span class="nv">c</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">s</span> <span class="p">(</span><span class="nv">make-sphere</span>
             <span class="ss">:radius</span> <span class="nv">r</span>
             <span class="ss">:center</span> <span class="p">(</span><span class="nv">make-point</span> <span class="ss">:x</span> <span class="nv">x</span> <span class="ss">:y</span> <span class="nv">y</span> <span class="ss">:z</span> <span class="nv">z</span><span class="p">)</span>
             <span class="ss">:color</span>  <span class="nv">c</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">push</span> <span class="nv">s</span> <span class="vg">*world*</span><span class="p">)</span>
    <span class="nv">s</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">intersect</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">funcall</span> <span class="p">(</span><span class="nb">typecase</span> <span class="nv">s</span> <span class="p">(</span><span class="nv">sphere</span> <span class="nf">#&#39;</span><span class="nv">sphere-intersect</span><span class="p">))</span>
           <span class="nv">s</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">sphere-intersect</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">pt</span> <span class="nv">xr</span> <span class="nv">yr</span> <span class="nv">zr</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">c</span> <span class="p">(</span><span class="nv">sphere-center</span> <span class="nv">s</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">n</span> <span class="p">(</span><span class="nv">minroot</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">xr</span><span class="p">)</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">yr</span><span class="p">)</span> <span class="p">(</span><span class="nv">sq</span> <span class="nv">zr</span><span class="p">))</span>
                     <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">xr</span><span class="p">)</span>
                             <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">yr</span><span class="p">)</span>
                             <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">zr</span><span class="p">)))</span>
                     <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">sq</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">c</span><span class="p">)))</span>
                        <span class="p">(</span><span class="nv">sq</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">c</span><span class="p">)))</span>
                        <span class="p">(</span><span class="nv">sq</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">c</span><span class="p">)))</span>
                        <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">sq</span> <span class="p">(</span><span class="nv">sphere-radius</span> <span class="nv">s</span><span class="p">)))))))</span>
    <span class="p">(</span><span class="k">if</span> <span class="nv">n</span>
        <span class="p">(</span><span class="nv">make-point</span> <span class="ss">:x</span>  <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">n</span> <span class="nv">xr</span><span class="p">))</span>
                    <span class="ss">:y</span>  <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">n</span> <span class="nv">yr</span><span class="p">))</span>
                    <span class="ss">:z</span>  <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">pt</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">n</span> <span class="nv">zr</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">normal</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">pt</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">funcall</span> <span class="p">(</span><span class="nb">typecase</span> <span class="nv">s</span> <span class="p">(</span><span class="nv">sphere</span> <span class="nf">#&#39;</span><span class="nv">sphere-normal</span><span class="p">))</span>
           <span class="nv">s</span> <span class="nv">pt</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">sphere-normal</span> <span class="p">(</span><span class="nv">s</span> <span class="nv">pt</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">c</span> <span class="p">(</span><span class="nv">sphere-center</span> <span class="nv">s</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">unit-vector</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">pt</span><span class="p">))</span>
                 <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">pt</span><span class="p">))</span>
                 <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">pt</span><span class="p">)))))</span>
</pre></div>
</td></tr></table></div>
<p><strong>圖 9.5 球體。</strong></p>
<p>函數 <tt class="docutils literal"><span class="pre">intersect</span></tt> 判斷與何種平面有關，並呼叫對應的函數。在此時只有一種， <tt class="docutils literal"><span class="pre">sphere-intersect</span></tt> ，但 <tt class="docutils literal"><span class="pre">intersect</span></tt> 是寫成可以容易擴展處理別種物體。</p>
<p>我們要怎麼找到一束光與一個球體的交點 (intersection)呢？光線是表示成點 <span class="math">\(p =〈x_0,y_0,x_0〉\)</span> 以及單位向量 <span class="math">\(v =〈x_r,y_r,x_r〉\)</span> 。每個在光上的點可以表示為 <span class="math">\(p+nv\)</span> ，對於某個 <em>n</em> –– 即 <span class="math">\(〈x_0+nx_r,y_0+ny_r,z_0+nz_r〉\)</span> 。光擊中球體的點的距離至中心 <span class="math">\(〈x_c,y_c,z_c〉\)</span> 會等於球體的半徑 <em>r</em> 。所以在下列這個交點的方程式會成立:</p>
<div class="math">
\[r = \sqrt{ (x_0 + nx_r + x_c)^2 + (y_0 + ny_r + y_c)^2 + (z_0 + nz_r + z_c)^2 }\]</div>
<p>這會給出</p>
<div class="math">
\[an^2 + bn + c = 0\]</div>
<p>其中</p>
<div class="math">
\[\begin{split}a = x_r^2 + y_r^2 + z_r^2\\b = 2((x_0-x_c)x_r + (y_0-y_c)y_r + (z_0-z_c)z_r)\\c = (x_0-x_c)^2 + (y_0-y_c)^2 + (z_0-z_c)^2 - r^2\end{split}\]</div>
<p>要找到交點我們只需要找到這個二次方程式的根。它可能是零、一個或兩個實數根。沒有根代表光沒有擊中球體；一個根代表光與球體交於一點 (擦過 「grazing hit」)；兩個根代表光與球體交於兩點 (一點交於進入時、一點交於離開時)。在最後一個情況裡，我們想要兩個根之中較小的那個； <em>n</em> 與光離開觀測點的距離成正比，所以先擊中的會是較小的 <em>n</em> 。所以我們呼叫 <tt class="docutils literal"><span class="pre">minroot</span></tt> 。如果有一個根， <tt class="docutils literal"><span class="pre">sphere-intersect</span></tt> 回傳代表該點的 <span class="math">\(〈x_0+nx_r,y_0+ny_r,z_0+nz_r〉\)</span> 。</p>
<p>圖 9.5 的另外兩個函數， <tt class="docutils literal"><span class="pre">normal</span></tt> 與 <tt class="docutils literal"><span class="pre">sphere-normal</span></tt> 類比於 <tt class="docutils literal"><span class="pre">intersect</span></tt> 與 <tt class="docutils literal"><span class="pre">sphere-intersect</span></tt> 。要找到垂直於球體很簡單 –– 不過是從該點至球體中心的向量而已。</p>
<p>圖 9.6 示範了我們如何產生圖片； <tt class="docutils literal"><span class="pre">ray-test</span></tt> 定義了 38 個球體（不全都看的見）然後產生一張圖片，叫做 &#8220;sphere.pgm&#8221; 。</p>
<p>(譯註：PGM 可移植灰度圖格式 ，更多訊息參見 <a class="reference external" href="http://en.wikipedia.org/wiki/Portable_graymap">wiki</a> )</p>
<div class="highlight-cl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nb">defun</span> <span class="nv">ray-test</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="p">(</span><span class="nv">res</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">setf</span> <span class="vg">*world*</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">defsphere</span> <span class="mi">0</span> <span class="mi">-300</span> <span class="mi">-1200</span> <span class="mi">200</span> <span class="mf">.8</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">defsphere</span> <span class="mi">-80</span> <span class="mi">-150</span> <span class="mi">-1200</span> <span class="mi">200</span> <span class="mf">.7</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">defsphere</span> <span class="mi">70</span> <span class="mi">-100</span> <span class="mi">-1200</span> <span class="mi">200</span> <span class="mf">.9</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">x</span> <span class="mi">-2</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">x</span><span class="p">)))</span>
      <span class="p">((</span><span class="nb">&gt;</span> <span class="nv">x</span> <span class="mi">2</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">z</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">z</span><span class="p">)))</span>
        <span class="p">((</span><span class="nb">&gt;</span> <span class="nv">z</span> <span class="mi">7</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">defsphere</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="mi">200</span><span class="p">)</span> <span class="mi">300</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">z</span> <span class="mi">-400</span><span class="p">)</span> <span class="mi">40</span> <span class="mf">.75</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">tracer</span> <span class="p">(</span><span class="nb">make-pathname</span> <span class="ss">:name</span> <span class="s">&quot;spheres.pgm&quot;</span><span class="p">)</span> <span class="nv">res</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p><strong>圖 9.6 使用光線追蹤器</strong></p>
<p>圖 9.7 是產生出來的圖片，其中 <tt class="docutils literal"><span class="pre">res</span></tt> 參數為 10。</p>
<div class="figure">
<img alt="../_images/Figure-9.71.png" src="../_images/Figure-9.71.png" />
</div>
<p><strong>圖 9.7: 追蹤光線的圖</strong></p>
<p>一個實際的光線追蹤器可以產生更複雜的圖片，因為它會考慮更多，我們只考慮了單一光源至平面某一點。可能會有多個光源，每一個有不同的強度。它們通常不會在觀測點，在這個情況程式需要檢查至光源的向量是否與其他平面相交，這會在第一個相交的平面上產生陰影。將光源放置於觀測點讓我們不需要考慮這麼複雜的情況，因為我們看不見在陰影中的任何點。</p>
<p>一個實際的光線追蹤器不僅追蹤光第一個擊中的平面，也會加入其它平面的反射光。一個實際的光線追蹤器會是有顏色的，並可以模型化出透明或是閃耀的平面。但基本的算法會與圖 9.3 所展示的差不多，而許多改進只需要遞迴的使用同樣的成分。</p>
<p>一個實際的光線追蹤器可以是高度優化的。這裡給出的程式為了精簡寫成，甚至沒有如 Lisp 程式設計師會最佳化的那樣，就僅是一個光線追蹤器而已。僅加入型態與行內宣告 (13.3 節)就可以讓它變得兩倍以上快。</p>
</div>
<div class="section" id="chapter-9-summary">
<h2>Chapter 9 總結 (Summary)<a class="headerlink" href="#chapter-9-summary" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li>Common Lisp 提供整數 (integers)、比值 (ratios)、浮點數 (floating-point numbers)以及複數 (complex numbers)。</li>
<li>數字可以被約分或轉換 (converted)，而它們的位數 (components)可以被取出。</li>
<li>用來比較數字的判斷式可以接受任意數量的參數，以及比較下一數對 (successive pairs) –– <cite>/=</cite> 函數除外，它是用來比較所有的數對 (pairs)。</li>
<li>Common Lisp 幾乎提供你在低階科學計算機可以看到的數值函數。同樣的函數普遍可應用在多種類型的數字上。</li>
<li>Fixnum 是小至可以塞入一個字 (word)的整數。它們在必要時會悄悄但花費昂貴地轉成大數 (bignum)。Common Lisp 提供最多四種浮點數。每一個浮點表示法的限制是實現相關的 (implementation-dependent)常數。</li>
<li>一個光線追蹤器 (ray-tracer)通過追蹤光線來產生圖像，使得每一像素回到模擬的世界。</li>
</ol>
</div>
<div class="section" id="chapter-9-exercises">
<h2>Chapter 9 練習 (Exercises)<a class="headerlink" href="#chapter-9-exercises" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li>定義一個函數，接受一個實數列表，若且唯若 (iff)它們是非遞減 (nondecreasing)順序時回傳真。</li>
<li>定義一個函數，接受一個整數 <tt class="docutils literal"><span class="pre">cents</span></tt> 並回傳四個值，將數字用 <tt class="docutils literal"><span class="pre">25-</span></tt> , <tt class="docutils literal"><span class="pre">10-</span></tt> , <tt class="docutils literal"><span class="pre">5-</span></tt> , <tt class="docutils literal"><span class="pre">1-</span></tt> 來顯示，使用最少數量的硬幣。(譯註: <tt class="docutils literal"><span class="pre">25-</span></tt> 是 25 美分，以此類推)</li>
<li>一個遙遠的星球住著兩種生物， wigglies 與 wobblies 。 Wigglies 與 wobblies 唱歌一樣厲害。每年都有一個比賽來選出十大最佳歌手。下面是過去十年的結果:</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">YEAR</th>
<th class="head">1</th>
<th class="head">2</th>
<th class="head">3</th>
<th class="head">4</th>
<th class="head">5</th>
<th class="head">6</th>
<th class="head">7</th>
<th class="head">8</th>
<th class="head">9</th>
<th class="head">10</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>WIGGLIES</td>
<td>6</td>
<td>5</td>
<td>6</td>
<td>4</td>
<td>5</td>
<td>5</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>WOBBLIES</td>
<td>4</td>
<td>5</td>
<td>4</td>
<td>6</td>
<td>5</td>
<td>5</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>5</td>
</tr>
</tbody>
</table>
<p>寫一個程式來模擬這樣的比賽。你的結果實際上有建議委員會每年選出 10 個最佳歌手嗎？</p>
<ol class="arabic simple" start="4">
<li>定義一個函數，接受 8 個表示二維空間中兩個線段端點的實數，若線段沒有相交，則回傳假，或回傳兩個值表示相交點的 <tt class="docutils literal"><span class="pre">x</span></tt> 座標與 <tt class="docutils literal"><span class="pre">y</span></tt> 座標。</li>
<li>假設 <tt class="docutils literal"><span class="pre">f</span></tt> 是一個接受一個 (實數) 參數的函數，而 <tt class="docutils literal"><span class="pre">min</span></tt> 與 <tt class="docutils literal"><span class="pre">max</span></tt> 是有著不同正負號的非零實數，使得 <tt class="docutils literal"><span class="pre">f</span></tt> 對於參數 <tt class="docutils literal"><span class="pre">i</span></tt> 有一個根 (回傳零)並滿足 <tt class="docutils literal"><span class="pre">min</span> <span class="pre">&lt;</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">max</span></tt> 。定義一個函數，接受四個參數， <tt class="docutils literal"><span class="pre">f</span></tt> , <tt class="docutils literal"><span class="pre">min</span></tt> , <tt class="docutils literal"><span class="pre">max</span></tt> 以及 <tt class="docutils literal"><span class="pre">epsilon</span></tt> ，並回傳一個 <tt class="docutils literal"><span class="pre">i</span></tt> 的近似值，準確至正負 <tt class="docutils literal"><span class="pre">epsilon</span></tt> 之內。</li>
<li><em>Honer&#8217;s method</em> 是一個有效率求出多項式的技巧。要找到 <span class="math">\(ax^3+bx^2+cx+d\)</span> 你對 <tt class="docutils literal"><span class="pre">x(x(ax+b)+c)+d</span></tt> 求值。定義一個函數，接受一個或多個參數 –– x 的值伴隨著 <em>n</em> 個實數，用來表示 <tt class="docutils literal"><span class="pre">(n-1)</span></tt> 次方的多項式的係數 –– 並用 <em>Honer&#8217;s method</em> 計算出多項式的值。</li>
</ol>
<p>譯註: <a class="reference external" href="http://en.wikipedia.org/wiki/Horner's_method">Honer&#8217;s method on wiki</a></p>
<ol class="arabic simple" start="7">
<li>你的 Common Lisp 實現使用了幾個位元來表示定數 (fixnum)？</li>
<li>你的 Common Lisp 實現提供幾種不同的浮點數？</li>
</ol>
<p class="rubric">腳註</p>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>當 <tt class="docutils literal"><span class="pre">format</span></tt> 取整顯示時，它不保證會取成偶數或奇數。見 125 頁 (譯註: 7.4 節)。</td></tr>
</tbody>
</table>
</div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'acl-chinese';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                  </div></div>
              </article><div class="clearer"></div>
          </div><div class="span3">
                <div class="sphinxsidebar">
      <div id="sidenav" class="box sphinxsidebarwrapper">


<h4><a href="../index.html">內容目录</a></h4>
  <ul>
<li><a class="reference internal" href="#">第九章：數字</a><ul>
<li><a class="reference internal" href="#types">9.1 型別 (Types)</a></li>
<li><a class="reference internal" href="#conversion-and-extraction">9.2 轉換及取出 (Conversion and Extraction)</a></li>
<li><a class="reference internal" href="#comparison">9.3 比較 (Comparison)</a></li>
<li><a class="reference internal" href="#arithematic">9.4 算術 (Arithematic)</a></li>
<li><a class="reference internal" href="#exponentiation">9.5 指數 (Exponentiation)</a></li>
<li><a class="reference internal" href="#trigometric-functions">9.6 三角函數 (Trigometric Functions)</a></li>
<li><a class="reference internal" href="#representations">9.7 表示法 (Representations)</a></li>
<li><a class="reference internal" href="#example-ray-tracing">9.8 範例：追蹤光線 (Example: Ray-Tracing)</a></li>
<li><a class="reference internal" href="#chapter-9-summary">Chapter 9 總結 (Summary)</a></li>
<li><a class="reference internal" href="#chapter-9-exercises">Chapter 9 練習 (Exercises)</a></li>
</ul>
</li>
</ul>

  
    <h3>本页</h3>
    <ul class="this-page-menu">
      
      
        <li><a href="https://github.com/acl-translation/acl-chinese/blob/redirect-to-new-domain/zhTW/ch9.rst">
          Show on GitHub</a></li>
        <li><a href="https://github.com/acl-translation/acl-chinese/edit/redirect-to-new-domain/zhTW/ch9.rst">
          Edit on GitHub</a></li>
      
    </ul>
  
</div>
    </div>
              </div></div>
      </div>
<footer class="container-fluid">
        <hr />&copy; 版权所有 2012, Juanito Fatas Huang.最后更新日期是 Apr 22, 2013.使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.</footer>
 <!-- End original user content -->


<br>
<br>
<br>


<style type="text/css">
  .rtd-badge {
    position: fixed;
    display: block;
    bottom: 5px;
    height: 40px;
    text-indent: -9999em;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
  }
  #version_menu {
    position: fixed;
    display: none;
    bottom: 11px;
    right: 166px;
    list-style-type: none;
    margin: 0;
  }
  .footer_popout:hover #version_menu {
    display: block;
  }
  #version_menu li {
    display: block;
    float: right;
  }
  #version_menu li a {
    display: block;
    padding: 6px 10px 4px 10px;
    margin: 7px 7px 0 0;
    font-weight: bold;
    font-size: 14px;
    height: 20px;
    line-height: 17px;
    text-decoration: none;
    color: #fff;
    background: #8ca1af url(../images/gradient-light.png) bottom left repeat-x;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 1px #465158;
    -moz-box-shadow: 0 1px 1px #465158;
    -webkit-box-shadow: 0 1px 1px #465158;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
  }
  #version_menu li a:hover {
    text-decoration: none;
    background-color: #697983;
    box-shadow: 0 1px 0px #465158;
    -moz-box-shadow: 0 1px 0px #465158;
    -webkit-box-shadow: 0 1px 0px #465158;
  }
  .rtd-badge.rtd {
    background: #3b4449 url(//media.readthedocs.org//images/badge-rtd.png) scroll 0px -46px no-repeat;
    border: 1px solid #282E32;
    width: 41px;
    right: 5px;
  }
  .footer_popout:hover .rtd-badge.rtd {
    background-position: top left;
    width: 160px;
  }
  .rtd-badge.revsys { background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline-sponsored {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys-sm.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 205px;
    right: 173px;
  }

</style>
<div class="rtd_doc_footer">
  <div class="footer_popout">
    <a href="//readthedocs.org/projects/ansi-common-lisp/?fromdocs=ansi-common-lisp" class="rtd-badge rtd"> Brought to you by Read the Docs</a>
    <ul id="version_menu">
      
        <li><a href="/en/latest/">latest</a></li>
      
    </ul>
  </div>
</div>
<!-- RTD Analytics Code -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<!-- User Analytics Code -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26995626-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</body>
</html>